import json
import requests
import subprocess
import time
import sys
import os
import datetime  # Ensure datetime is imported
import pymongo  # For direct DB check

LOG_FILE = "chatflow_sync_test.log"
SCRIPT_DIR = os.path.dirname(os.path.abspath(__file__))
LOG_PATH = os.path.join(SCRIPT_DIR, LOG_FILE)

# Configuration
API_BASE_URL = "http://localhost:8000"

MONGODB_CONTAINER = "auth-mongodb"
ADMIN_USER = {
    "username": "admin",
    "email": "admin@example.com",
    "password": "admin@admin@aidcec",  # Please change this
}
SUPERVISOR_USERS = [
    {
        "username": "supervisor1",
        "email": "supervisor1@example.com",
        "password": "Supervisor1@",
        "role": "supervisor",
    },
    {
        "username": "supervisor2",
        "email": "supervisor2@example.com",
        "password": "Supervisor2@",
        "role": "supervisor",
    },
]
REGULAR_USERS = [
    {
        "username": f"User{i:02d}",
        "email": f"user{i:02d}@aidcec.com",
        "password": f"User{i:02d}@aidcec",
        "role": "enduser",
    }
    for i in range(1, 3)
]

# For a REGULAR_USERS
# login through API_BASE_URL
# List the chatflow that he/she have access to [previously given by Admin]


def get_user_token(user):
    """Log in as a specified user and get the access token"""
    print(f"\n--- Getting access token for user: {user['username']} ---")
    try:
        response = requests.post(
            f"{API_BASE_URL}/api/v1/chat/authenticate",
            json={
                "username": user["username"],
                "password": user["password"],
            },
        )
        if response.status_code == 200:
            data = response.json()
            token = data.get("access_token")
            if token:
                print(f"✅ Got access token for {user['username']}")
                return token
            else:
                print(f"❌ No access token in response for {user['username']}")
        else:
            print(
                f"❌ Failed to get token for {user['username']}: {response.status_code} {response.text}"
            )
    except requests.RequestException as e:
        print(f"❌ Request error: {e}")
    except Exception as e:
        print(f"❌ Unexpected error: {e}")
    return None


def list_accessible_chatflows(token, username):
    """
    Lists accessible chatflows for the given user token.
    Returns the ID of the first accessible chatflow, or None.
    """
    print(f"\n--- Listing accessible chatflows for user: {username} ---")
    if not token:
        print("❌ Cannot list chatflows without a token.")
        return None
    chatflows_url = f"{API_BASE_URL}/api/v1/chatflows"
    headers = {"Authorization": f"Bearer {token}"}
    try:
        response = requests.get(chatflows_url, headers=headers)
        if response.status_code == 200:
            data = response.json()
            print(f"✅ {username} has access to {len(data)} chatflows.")
            if data:
                print(f"First accessible chatflow: {data[0]}")
                return data[0]["id"] if "id" in data[0] else None
            else:
                print(f"No accessible chatflows for {username}.")
                return None
        else:
            print(
                f"❌ Failed to list chatflows for {username}: {response.status_code} {response.text}"
            )
            return None
    except requests.RequestException as e:
        print(f"❌ Request error while listing chatflows for {username}: {e}")
        return None
    except Exception as e:
        print(f"❌ Unexpected error while listing chatflows for {username}: {e}")
        return None


def test_chat_predict(token, username, chatflow_id, question):
    """
    Tests the chat predict endpoint for a given chatflow_id and question.
    """
    print(
        f"\n--- Testing chat predict for user: {username} on chatflow: {chatflow_id} ---"
    )
    if not token:
        print("❌ Cannot test predict without a token.")
        return
    if not chatflow_id:
        print("❌ Cannot test predict without a chatflow_id.")
        return
    predict_url = f"{API_BASE_URL}/api/v1/chat/predict"
    headers = {"Authorization": f"Bearer {token}"}
    payload = {
        "chatflow_id": chatflow_id,
        "question": question,
    }
    try:
        response = requests.post(predict_url, headers=headers, json=payload)
        timestamp = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        log_entry_prefix = f"[{timestamp}] User '{username}' predicting on chatflow '{chatflow_id}' with question '{question}':"
        if response.status_code == 200:
            data = response.json()
            print(f"✅ Prediction response: {data}")
            with open(LOG_PATH, "a", encoding="utf-8") as log_file:
                log_file.write(f"{log_entry_prefix} SUCCESS\n{data}\n")
        else:
            print(f"❌ Prediction failed: {response.status_code} {response.text}")
            with open(LOG_PATH, "a", encoding="utf-8") as log_file:
                log_file.write(f"{log_entry_prefix} FAIL\n{response.text}\n")
    except requests.RequestException as e:
        print(
            f"❌ Request error during prediction for {username} on chatflow {chatflow_id}: {e}"
        )
        with open(LOG_PATH, "a", encoding="utf-8") as log_file:
            log_file.write(
                f"[{timestamp}] User '{username}' predicting on chatflow '{chatflow_id}': Request error: {e}\n"
            )
    except Exception as e:
        print(
            f"❌ Unexpected error during prediction for {username} on chatflow {chatflow_id}: {e}"
        )
        with open(LOG_PATH, "a") as log_file:
            log_file.write(
                f"[{timestamp}] User '{username}' predicting on chatflow '{chatflow_id}': Unexpected error: {e}\n"
            )


def test_chat_predict_stream(token, username, chatflow_id, question):
    """
    Tests the chat predict stream endpoint for a given chatflow_id and question.
    """
    print(
        f"\n--- Testing chat predict STREAM for user: {username} on chatflow: {chatflow_id} ---"
    )
    if not token:
        print("❌ Cannot test predict stream without a token.")
        return
    if not chatflow_id:
        print("❌ Cannot test predict stream without a chatflow_id.")
        return
    predict_url = f"{API_BASE_URL}/api/v1/chat/predict/stream"
    headers = {"Authorization": f"Bearer {token}"}
    payload = {
        "chatflow_id": chatflow_id,
        "question": question,
    }
    try:
        # Use stream=True to handle the streaming response
        response = requests.post(
            predict_url, headers=headers, json=payload, stream=True
        )
        timestamp = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        log_entry_prefix = f"[{timestamp}] User '{username}' streaming on chatflow '{chatflow_id}' with question '{question}':"

        if response.status_code == 200:
            print(f"✅ Stream started successfully for {username}. Chunks:")
            full_response = ""
            # Iterate over the response chunks
            for chunk in response.iter_content(
                chunk_size=None
            ):  # Use iter_content for raw bytes
                if chunk:
                    decoded_chunk = chunk.decode("utf-8")  # Decode bytes to string
                    print(
                        decoded_chunk, end="", flush=True
                    )  # Print chunk without newline, flush to show immediately
                    full_response += decoded_chunk
            print("\n--- End of Stream ---")  # Print a newline at the end

            with open(LOG_PATH, "a", encoding="utf-8") as log_file:
                log_file.write(
                    f"{log_entry_prefix} SUCCESS - Full response: {full_response}\n"
                )
        else:
            print(
                f"❌ Prediction stream failed for {username} on chatflow {chatflow_id}: {response.status_code}"
            )
            error_message = response.text
            print(f"   Error: {error_message}")
            with open(LOG_PATH, "a", encoding="utf-8") as log_file:
                log_file.write(
                    f"{log_entry_prefix} FAILED - Status: {response.status_code}, Error: {error_message}\n"
                )

    except requests.RequestException as e:
        timestamp = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        print(
            f"❌ Request error during prediction stream for {username} on chatflow {chatflow_id}: {e}"
        )
        with open(LOG_PATH, "a", encoding="utf-8") as log_file:
            log_file.write(
                f"[{timestamp}] User '{username}' predicting on chatflow '{chatflow_id}': Request error: {e}\n"
            )
    except Exception as e:
        timestamp = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        print(
            f"❌ Unexpected error during prediction stream for {username} on chatflow {chatflow_id}: {e}"
        )
        with open(LOG_PATH, "a") as log_file:
            log_file.write(
                f"[{timestamp}] User '{username}' predicting on chatflow '{chatflow_id}': Unexpected error: {e}\n"
            )


# Main execution
if __name__ == "__main__":

    # User login and tests
    for user in REGULAR_USERS:
        user_token = get_user_token(user)
        if user_token:
            chatflow_id = list_accessible_chatflows(user_token, user["username"])
            if chatflow_id:
                test_chat_predict(
                    user_token, user["username"], chatflow_id, "Hello, can you help me?"
                )
                test_chat_predict_stream(
                    user_token, user["username"], chatflow_id, "Tell me a story."
                )
            else:
                print(f"❌ No accessible chatflows for user {user['username']}.")
        else:
            print(f"❌ Could not get token for user {user['username']}.")
"""
An example of the output of the tests:
--- Getting access token for user: user1 ---
✅ Got access token for user1

--- Listing accessible chatflows for user: user1 ---
✅ user1 has access to 1 chatflows.
First accessible chatflow: {'id': '7a2f12b2-25eb-46e0-856a-a08cf5a99c0f', 'name': 'eduhkTest', 'description': '', 'is_public': False}

--- Testing chat predict for user: user1 on chatflow: 7a2f12b2-25eb-46e0-856a-a08cf5a99c0f ---
✅ Prediction response: {'response': '{"event":"start","data":"Of"}{"event":"token","data":"Of"}{"event":"token","data":" course! I\'d"}{"event":"token","data":" be happy to help."}{"event":"token","data":" What do"}{"event":"token","data":" you need assistance"}{"event":"token","data":" with?\\n\\nIf"}{"event":"token","data":" you have"}{"event":"token","data":" a specific"}{"event":"token","data":" question, need"}{"event":"token","data":" information on a"}{"event":"token","data":" topic"}{"event":"token","data":", or"}{"event":"token","data":" require"}{"event":"token","data":" guidance"}{"event":"token","data":" on a task"}{"event":"token","data":", feel"}{"event":"token","data":" free to ask."}{"event":"token","data":" Here"}{"event":"token","data":" are"}{"event":"token","data":" a few areas"}{"event":"token","data":" where I can help"}{"event":"token","data":":\\n\\n1. **General"}{"event":"token","data":" Knowledge"}{"event":"token","data":"**:\\n   - Facts"}{"event":"token","data":" about history"}{"event":"token","data":", science, geography"}{"event":"token","data":", etc"}{"event":"token","data":".\\n   \\n"}{"event":"token","data":"2. **Technology"}{"event":"token","data":"**:\\n   - Information about"}{"event":"token","data":" software, hardware"}{"event":"token","data":", programming"}{"event":"token","data":", etc"}{"event":"token","data":".\\n   \\n3. **Health"}{"event":"token","data":" and Wellness**:\\n   -"}{"event":"token","data":" General advice"}{"event":"token","data":" on fitness"}{"event":"token","data":", nutrition, and"}{"event":"token","data":" mental health ("}{"event":"token","data":"note"}{"event":"token","data":": always consult a professional"}{"event":"token","data":" for personal"}{"event":"token","data":" health concerns"}{"event":"token","data":").\\n\\n"}{"event":"token","data":"4. **Entertainment"}{"event":"token","data":"**:\\n   - Recommendations"}{"event":"token","data":" for"}{"event":"token","data":" movies, books"}{"event":"token","data":", music"}{"event":"token","data":", etc"}{"event":"token","data":".\\n\\n5. **Every"}{"event":"token","data":"day Tasks"}{"event":"token","data":"**:\\n   - Tips for"}{"event":"token","data":" cooking, cleaning"}{"event":"token","data":", organizing, etc"}{"event":"token","data":".\\n\\n6. **Learning"}{"event":"token","data":" and Education**:\\n   -"}{"event":"token","data":" Study"}{"event":"token","data":" tips, explanations"}{"event":"token","data":" of"}{"event":"token","data":" concepts, etc"}{"event":"token","data":".\\n\\nJust"}{"event":"token","data":" let me know what you’"}{"event":"token","data":"re looking"}{"event":"token","data":" for!"}{"event":"metadata","data":{"chatId":"0717d1bc-0042-4fd4-b8bd-5e3bb103ecd5","chatMessageId":"280aaecb-1757-4f28-97d6-f67e3e6a5da0","question":"Hello, can you help me?","sessionId":"0717d1bc-0042-4fd4-b8bd-5e3bb103ecd5","memoryType":"Buffer Memory"}}{"event":"end","data":"[DONE]"}', 'metadata': {'chatflow_id': '7a2f12b2-25eb-46e0-856a-a08cf5a99c0f', 'cost': 1, 'remaining_credits': 456, 'user': 'user1', 'streaming': True}}

--- Testing chat predict STREAM for user: user1 on chatflow: 7a2f12b2-25eb-46e0-856a-a08cf5a99c0f ---
✅ Stream started successfully for user1. Chunks:
{"event":"start","data":"Of"}{"event":"token","data":"Of"}{"event":"token","data":" course! Let'"}{"event":"token","data":"s dive"}{"event":"token","data":" into a whimsical"}{"event":"token","data":" tale.\n\n"}{"event":"token","data":"---\n\n###"}{"event":"token","data":" The Enchanted Forest"}{"event":"token","data":" of"}{"event":"token","data":" El"}{"event":"token","data":"doria\n\nIn"}{"event":"token","data":" a land"}{"event":"token","data":" far,"}{"event":"token","data":" far away, nestled"}{"event":"token","data":" between rolling"}{"event":"token","data":" hills"}{"event":"token","data":" and shimmering lakes"}{"event":"token","data":", lay"}{"event":"token","data":" the Enchanted"}{"event":"token","data":" Forest of"}{"event":"token","data":" Eldoria. This forest"}{"event":"token","data":" was unlike"}{"event":"token","data":" any other, for"}{"event":"token","data":" it was alive"}{"event":"token","data":" with magic"}{"event":"token","data":" and wonder"}{"event":"token","data":". The"}{"event":"token","data":" trees whispered secrets to"}{"event":"token","data":" those"}{"event":"token","data":" who listened"}{"event":"token","data":", and"}{"event":"token","data":" the flowers sang"}{"event":"token","data":" sweet"}{"event":"token","data":" lull"}{"event":"token","data":"abies at"}{"event":"token","data":" dusk"}{"event":"token","data":".\n\nAt"}{"event":"token","data":" the heart of El"}{"event":"token","data":"doria lived"}{"event":"token","data":" a young"}{"event":"token","data":" girl named Li"}{"event":"token","data":"ora. Li"}{"event":"token","data":"ora had"}{"event":"token","data":" bright emerald"}{"event":"token","data":" eyes that sparkled with curiosity"}{"event":"token","data":" and"}{"event":"token","data":" a heart full of courage"}{"event":"token","data":". She"}{"event":"token","data":" often wandered"}{"event":"token","data":" through"}{"event":"token","data":" the forest, discovering"}{"event":"token","data":" its"}{"event":"token","data":" hidden treasures"}{"event":"token","data":" and be"}{"event":"token","data":"friend"}{"event":"token","data":"ing its"}{"event":"token","data":" mystical"}{"event":"token","data":" creatures.\n\nOne sunny"}{"event":"token","data":" morning"}{"event":"token","data":", as"}{"event":"token","data":" Liora skipped"}{"event":"token","data":" through a"}{"event":"token","data":" meadow, she"}{"event":"token","data":" stumbled upon a"}{"event":"token","data":" peculiar sight"}{"event":"token","data":"."}{"event":"token","data":" A small"}{"event":"token","data":", shimmering pool"}{"event":"token","data":" of"}{"event":"token","data":" water caught"}{"event":"token","data":" her eye"}{"event":"token","data":". It was unlike"}{"event":"token","data":" any pond"}{"event":"token","data":" she had seen"}{"event":"token","data":" before—its"}{"event":"token","data":" surface sparkled"}{"event":"token","data":" like liquid star"}{"event":"token","data":"light"}{"event":"token","data":".\n\nAs"}{"event":"token","data":" she"}{"event":"token","data":" approached,"}{"event":"token","data":" a"}{"event":"token","data":" gentle"}{"event":"token","data":" voice echoed from"}{"event":"token","data":" the"}{"event":"token","data":" pool"}{"event":"token","data":". \"Hello"}{"event":"token","data":", Liora,\""}{"event":"token","data":" it said"}{"event":"token","data":". Start"}{"event":"token","data":"led, Li"}{"event":"token","data":"ora looked around"}{"event":"token","data":" but saw"}{"event":"token","data":" no one. \"Who"}{"event":"token","data":"'"}{"event":"token","data":"s there"}{"event":"token","data":"?\" she called"}{"event":"token","data":" out.\n\n\"It"}{"event":"token","data":" is"}{"event":"token","data":" I"}{"event":"token","data":", Lumina"}{"event":"token","data":","}{"event":"token","data":" the Guardian"}{"event":"token","data":" of the Enchanted"}{"event":"token","data":" Forest"}{"event":"token","data":",\" the voice"}{"event":"token","data":" replied. \""}{"event":"token","data":"I have"}{"event":"token","data":" been waiting"}{"event":"token","data":" for you"}{"event":"token","data":".\"\n\nLi"}{"event":"token","data":"ora's eyes"}{"event":"token","data":" widened with"}{"event":"token","data":" excitement"}{"event":"token","data":". \"Why"}{"event":"token","data":" have you been"}{"event":"token","data":" waiting for me"}{"event":"token","data":"?\"\n\n\"The"}{"event":"token","data":" forest is"}{"event":"token","data":" in danger"}{"event":"token","data":",\" Lumina"}{"event":"token","data":" explained. \""}{"event":"token","data":"An"}{"event":"token","data":" ancient darkness"}{"event":"token","data":" is"}{"event":"token","data":" creeping"}{"event":"token","data":" in"}{"event":"token","data":","}{"event":"token","data":" threatening to extinguish"}{"event":"token","data":" the magic"}{"event":"token","data":" that keeps"}{"event":"token","data":" Eldoria alive. Only"}{"event":"token","data":" a pure"}{"event":"token","data":" heart and"}{"event":"token","data":" a brave soul"}{"event":"token","data":" can save"}{"event":"token","data":" us"}{"event":"token","data":".\"\n\nDetermine"}{"event":"token","data":"d to"}{"event":"token","data":" help, Liora asked"}{"event":"token","data":", \"What"}{"event":"token","data":" must"}{"event":"token","data":" I do?\"\n\n"}{"event":"token","data":"\"You"}{"event":"token","data":" must find"}{"event":"token","data":" the three"}{"event":"token","data":" Crystals of Light"}{"event":"token","data":",\" Lumina said"}{"event":"token","data":". \"They"}{"event":"token","data":" are hidden throughout"}{"event":"token","data":" the forest, guarded"}{"event":"token","data":" by its"}{"event":"token","data":" most"}{"event":"token","data":" mystical"}{"event":"token","data":" creatures. Only"}{"event":"token","data":" with"}{"event":"token","data":" their"}{"event":"token","data":" power"}{"event":"token","data":" can"}{"event":"token","data":" we"}{"event":"token","data":" restore the forest"}{"event":"token","data":"'"}{"event":"token","data":"s magic.\"\n\nWithout"}{"event":"token","data":" hesitation, Liora set"}{"event":"token","data":" off on"}{"event":"token","data":" her quest. Her"}{"event":"token","data":" first destination"}{"event":"token","data":" was the"}{"event":"token","data":" Whispering Woods"}{"event":"token","data":", home"}{"event":"token","data":" to the wise"}{"event":"token","data":" old Owl"}{"event":"token","data":"or"}{"event":"token","data":", who"}{"event":"token","data":" guarded the Crystal"}{"event":"token","data":" of Wisdom"}{"event":"token","data":".\n\nAs"}{"event":"token","data":" she navigated"}{"event":"token","data":" through"}{"event":"token","data":" the dense trees"}{"event":"token","data":", she"}{"event":"token","data":" heard faint"}{"event":"token","data":" whispers"}{"event":"token","data":" guiding"}{"event":"token","data":" her."}{"event":"token","data":" Soon"}{"event":"token","data":", she stood"}{"event":"token","data":" before"}{"event":"token","data":" a"}{"event":"token","data":" grand"}{"event":"token","data":","}{"event":"token","data":" ancient oak"}{"event":"token","data":" tree"}{"event":"token","data":" where"}{"event":"token","data":" Owl"}{"event":"token","data":"or perched"}{"event":"token","data":"."}{"event":"token","data":" His"}{"event":"token","data":" feathers"}{"event":"token","data":" gli"}{"event":"token","data":"stened"}{"event":"token","data":" like silver"}{"event":"token","data":", and his"}{"event":"token","data":" eyes were"}{"event":"token","data":" pools"}{"event":"token","data":" of knowledge"}{"event":"token","data":".\n\n\"Greet"}{"event":"token","data":"ings"}{"event":"token","data":", Li"}{"event":"token","data":"ora,\" Owl"}{"event":"token","data":"or hoo"}{"event":"token","data":"ted. \"You"}{"event":"token","data":" seek the Crystal"}{"event":"token","data":" of Wisdom."}{"event":"token","data":" To earn"}{"event":"token","data":" it, you must answer"}{"event":"token","data":" my"}{"event":"token","data":" riddle.\"\n\n"}{"event":"token","data":"Liora nodded"}{"event":"token","data":" eagerly"}{"event":"token","data":". Owl"}{"event":"token","data":"or began"}{"event":"token","data":", \"I"}{"event":"token","data":" speak without"}{"event":"token","data":" a mouth"}{"event":"token","data":" and"}{"event":"token","data":" hear"}{"event":"token","data":" without ears"}{"event":"token","data":". I"}{"event":"token","data":" have no"}{"event":"token","data":" body, but I come"}{"event":"token","data":" alive with wind"}{"event":"token","data":". What"}{"event":"token","data":" am I?\"\n\n"}{"event":"token","data":"Li"}{"event":"token","data":"ora thought for a moment"}{"event":"token","data":","}{"event":"token","data":" then smiled"}{"event":"token","data":"."}{"event":"token","data":" \"An"}{"event":"token","data":" echo!\"\n\n"}{"event":"token","data":"Owl"}{"event":"token","data":"or hoo"}{"event":"token","data":"ted in"}{"event":"token","data":" approval and"}{"event":"token","data":" handed"}{"event":"token","data":" her"}{"event":"token","data":" the"}{"event":"token","data":" Crystal"}{"event":"token","data":" of Wisdom,"}{"event":"token","data":" a radiant"}{"event":"token","data":" blue"}{"event":"token","data":" gem that"}{"event":"token","data":" pulsed with knowledge"}{"event":"token","data":".\n\nHer"}{"event":"token","data":" next stop"}{"event":"token","data":" was the"}{"event":"token","data":" Glittering Glad"}{"event":"token","data":"e, where"}{"event":"token","data":" the playful"}{"event":"token","data":" sprite"}{"event":"token","data":"s"}{"event":"token","data":" guarded"}{"event":"token","data":" the Crystal"}{"event":"token","data":" of Joy"}{"event":"token","data":". The"}{"event":"token","data":" sprites were tiny"}{"event":"token","data":","}{"event":"token","data":" luminous"}{"event":"token","data":" being"}{"event":"token","data":"s who"}{"event":"token","data":" danced"}{"event":"token","data":" in the sunlight"}{"event":"token","data":", leaving"}{"event":"token","data":" trails"}{"event":"token","data":" of glittering"}{"event":"token","data":" dust"}{"event":"token","data":".\n\n"}{"event":"token","data":"\""}{"event":"token","data":"To"}{"event":"token","data":" earn"}{"event":"token","data":" the Crystal of Joy"}{"event":"token","data":",\" the"}{"event":"token","data":" sprites"}{"event":"token","data":" chimed"}{"event":"token","data":" in"}{"event":"token","data":" unison, \"you"}{"event":"token","data":" must make"}{"event":"token","data":" us laugh!\"\n\n"}{"event":"token","data":"Liora closed"}{"event":"token","data":" her eyes"}{"event":"token","data":", remembering"}{"event":"token","data":" the"}{"event":"token","data":" funniest"}{"event":"token","data":" moments"}{"event":"token","data":" with"}{"event":"token","data":" her friends"}{"event":"token","data":". She mimicked"}{"event":"token","data":" the"}{"event":"token","data":" clumsy"}{"event":"token","data":" antics of a"}{"event":"token","data":" squirrel she"}{"event":"token","data":" once"}{"event":"token","data":" saw"}{"event":"token","data":" trying"}{"event":"token","data":" to crack"}{"event":"token","data":" a nut"}{"event":"token","data":", and the sprite"}{"event":"token","data":"s burst into"}{"event":"token","data":" pe"}{"event":"token","data":"als"}{"event":"token","data":" of"}{"event":"token","data":" laughter. They"}{"event":"token","data":" rewarded"}{"event":"token","data":" her with the"}{"event":"token","data":" Crystal of Joy, a sparkling"}{"event":"token","data":" yellow"}{"event":"token","data":" gem that"}{"event":"token","data":" glowed"}{"event":"token","data":" with happiness"}{"event":"token","data":".\n\nFinally"}{"event":"token","data":", Li"}{"event":"token","data":"ora journey"}{"event":"token","data":"ed to the Mystic"}{"event":"token","data":" Mountains"}{"event":"token","data":", where the noble"}{"event":"token","data":" "}{"event":"token","data":"griffin, Gry"}{"event":"token","data":"phon"}{"event":"token","data":","}{"event":"token","data":" guarded the Crystal"}{"event":"token","data":" of Courage"}{"event":"token","data":". Gry"}{"event":"token","data":"phon was"}{"event":"token","data":" a majestic"}{"event":"token","data":" creature with"}{"event":"token","data":" the"}{"event":"token","data":" body"}{"event":"token","data":" of a lion"}{"event":"token","data":" and the wings of"}{"event":"token","data":" an eagle.\n\n\"To"}{"event":"token","data":" earn the Crystal of Courage"}{"event":"token","data":",\" Gry"}{"event":"token","data":"phon roared"}{"event":"token","data":", \""}{"event":"token","data":"you must face"}{"event":"token","data":" your"}{"event":"token","data":" greatest"}{"event":"token","data":" fear.\"\n\n"}{"event":"token","data":"Liora took"}{"event":"token","data":" a deep breath"}{"event":"token","data":"."}{"event":"token","data":" Her"}{"event":"token","data":" greatest"}{"event":"token","data":" fear was losing"}{"event":"token","data":" her loved"}{"event":"token","data":" ones. With determination"}{"event":"token","data":","}{"event":"token","data":" she imagined"}{"event":"token","data":" standing"}{"event":"token","data":" strong"}{"event":"token","data":" even"}{"event":"token","data":" in the"}{"event":"token","data":" face of such"}{"event":"token","data":" loss"}{"event":"token","data":"."}{"event":"token","data":" Gryphon nodded"}{"event":"token","data":","}{"event":"token","data":" impressed by her"}{"event":"token","data":" bravery"}{"event":"token","data":", and presented"}{"event":"token","data":" her with the Crystal"}{"event":"token","data":" of Courage"}{"event":"token","data":", a"}{"event":"token","data":" brilliant red gem"}{"event":"token","data":" that shone"}{"event":"token","data":" with valor"}{"event":"token","data":".\n\nWith"}{"event":"token","data":" all three crystals"}{"event":"token","data":" in hand"}{"event":"token","data":", Li"}{"event":"token","data":"ora returned to the shimmering"}{"event":"token","data":" pool. Lumina"}{"event":"token","data":"'"}{"event":"token","data":"s voice"}{"event":"token","data":" welcomed"}{"event":"token","data":" her. \"Place"}{"event":"token","data":" the crystals"}{"event":"token","data":" in the pool,"}{"event":"token","data":" and the"}{"event":"token","data":" forest"}{"event":"token","data":"'"}{"event":"token","data":"s magic will be restored"}{"event":"token","data":".\"\n\nAs"}{"event":"token","data":" Liora dropped"}{"event":"token","data":" the crystals into"}{"event":"token","data":" the water"}{"event":"token","data":", a"}{"event":"token","data":" brilliant light erupted, spreading"}{"event":"token","data":" throughout"}{"event":"token","data":" El"}{"event":"token","data":"doria. The trees"}{"event":"token","data":" stood"}{"event":"token","data":" tall and"}{"event":"token","data":" proud, the flowers"}{"event":"token","data":" bloom"}{"event":"token","data":"ed vibrantly, and"}{"event":"token","data":" the air"}{"event":"token","data":" buzzed"}{"event":"token","data":" with renewed"}{"event":"token","data":" magic.\n\nLiora had"}{"event":"token","data":" saved"}{"event":"token","data":" the Enchanted"}{"event":"token","data":" Forest of"}{"event":"token","data":" Eldoria."}{"event":"token","data":" From that day"}{"event":"token","data":" forward, she"}{"event":"token","data":" was"}{"event":"token","data":" known as the Forest"}{"event":"token","data":"'"}{"event":"token","data":"s Guardian, cherished"}{"event":"token","data":" by all"}{"event":"token","data":" its inhabitants.\n\n"}{"event":"token","data":"And so, the"}{"event":"token","data":" forest"}{"event":"token","data":" thrived, its"}{"event":"token","data":" magic stronger"}{"event":"token","data":" than"}{"event":"token","data":" ever,"}{"event":"token","data":" thanks to the courage"}{"event":"token","data":","}{"event":"token","data":" wisdom"}{"event":"token","data":", and joy"}{"event":"token","data":" of one"}{"event":"token","data":" brave"}{"event":"token","data":" girl"}{"event":"token","data":".\n\n"}{"event":"token","data":"---\n\nI"}{"event":"token","data":" hope you enjoyed"}{"event":"token","data":" the"}{"event":"token","data":" story of"}{"event":"token","data":" Li"}{"event":"token","data":"ora and"}{"event":"token","data":" the Enchanted Forest of"}{"event":"token","data":" Eldoria!"}{"event":"metadata","data":{"chatId":"78ee3820-d1b1-549f-a234-c21995e780b5","chatMessageId":"4d605f09-4c2f-4501-b81e-8674e495fc82","question":"Tell me a story.","sessionId":"78ee3820-d1b1-549f-a234-c21995e780b5","memoryType":"Buffer Memory"}}{"event":"end","data":"[DONE]"}
--- End of Stream ---

--- Getting access token for user: user2 ---
✅ Got access token for user2

--- Listing accessible chatflows for user: user2 ---
✅ user2 has access to 1 chatflows.
First accessible chatflow: {'id': '7a2f12b2-25eb-46e0-856a-a08cf5a99c0f', 'name': 'eduhkTest', 'description': '', 'is_public': False}

--- Testing chat predict for user: user2 on chatflow: 7a2f12b2-25eb-46e0-856a-a08cf5a99c0f ---
✅ Prediction response: {'response': '{"event":"start","data":"Of"}{"event":"token","data":"Of"}{"event":"token","data":" course! I\'d"}{"event":"token","data":" be happy to help."}{"event":"token","data":" What do"}{"event":"token","data":" you need assistance with?\\n\\n"}{"event":"token","data":"If"}{"event":"token","data":" you have"}{"event":"token","data":" a specific"}{"event":"token","data":" question,"}{"event":"token","data":" need information"}{"event":"token","data":" on a topic"}{"event":"token","data":", or"}{"event":"token","data":" require"}{"event":"token","data":" guidance"}{"event":"token","data":" on a particular task"}{"event":"token","data":", feel"}{"event":"token","data":" free to ask."}{"event":"token","data":" Here"}{"event":"token","data":" are"}{"event":"token","data":" a few examples"}{"event":"token","data":" of things"}{"event":"token","data":" I can help with:\\n\\n"}{"event":"token","data":"1"}{"event":"token","data":". **General"}{"event":"token","data":" Knowledge"}{"event":"token","data":"**:"}{"event":"token","data":"\\n   - Facts"}{"event":"token","data":" about history"}{"event":"token","data":", science, geography"}{"event":"token","data":", etc"}{"event":"token","data":".\\n   - Explanation"}{"event":"token","data":"s"}{"event":"token","data":" of concepts"}{"event":"token","data":" or"}{"event":"token","data":" theories.\\n\\n2. **Technology"}{"event":"token","data":"**:\\n   - Troubleshooting"}{"event":"token","data":" tech"}{"event":"token","data":" issues"}{"event":"token","data":".\\n   - Explaining"}{"event":"token","data":" how"}{"event":"token","data":" software"}{"event":"token","data":" or devices"}{"event":"token","data":" work.\\n\\n"}{"event":"token","data":"3. **Every"}{"event":"token","data":"day Tasks"}{"event":"token","data":"**:\\n   - Cooking"}{"event":"token","data":" recipes"}{"event":"token","data":".\\n   - DIY"}{"event":"token","data":" project"}{"event":"token","data":" ideas"}{"event":"token","data":".\\n"}{"event":"token","data":"   - Tips for organizing"}{"event":"token","data":" or"}{"event":"token","data":" planning"}{"event":"token","data":".\\n\\n4. **Learning"}{"event":"token","data":" and"}{"event":"token","data":" Education"}{"event":"token","data":"**:\\n   - Study"}{"event":"token","data":" tips"}{"event":"token","data":".\\n"}{"event":"token","data":"   - Explanation"}{"event":"token","data":"s"}{"event":"token","data":" of academic"}{"event":"token","data":" subjects.\\n"}{"event":"token","data":"   - Help"}{"event":"token","data":" with homework"}{"event":"token","data":" ("}{"event":"token","data":"within"}{"event":"token","data":" reason"}{"event":"token","data":").\\n\\n5. **Health"}{"event":"token","data":" and Wellness"}{"event":"token","data":"**:\\n   - General"}{"event":"token","data":" advice on diet"}{"event":"token","data":" and exercise"}{"event":"token","data":".\\n   - Information"}{"event":"token","data":" about"}{"event":"token","data":" common"}{"event":"token","data":" health"}{"event":"token","data":" conditions ("}{"event":"token","data":"not"}{"event":"token","data":" a substitute"}{"event":"token","data":" for professional medical"}{"event":"token","data":" advice).\\n\\n6. **Entertainment"}{"event":"token","data":"**:\\n   - Recommendations"}{"event":"token","data":" for books"}{"event":"token","data":", movies, TV"}{"event":"token","data":" shows,"}{"event":"token","data":" etc"}{"event":"token","data":".\\n   - Information"}{"event":"token","data":" about artists"}{"event":"token","data":", bands"}{"event":"token","data":", or"}{"event":"token","data":" genres.\\n\\nJust"}{"event":"token","data":" let me know what you’"}{"event":"token","data":"re looking for!"}{"event":"metadata","data":{"chatId":"3d6c7df6-1768-4bec-a913-80c02c1d96c5","chatMessageId":"3cbaef9e-c256-4c54-b111-c04b675db0ad","question":"Hello, can you help me?","sessionId":"3d6c7df6-1768-4bec-a913-80c02c1d96c5","memoryType":"Buffer Memory"}}{"event":"end","data":"[DONE]"}', 'metadata': {'chatflow_id': '7a2f12b2-25eb-46e0-856a-a08cf5a99c0f', 'cost': 1, 'remaining_credits': 485, 'user': 'user2', 'streaming': True}}

--- Testing chat predict STREAM for user: user2 on chatflow: 7a2f12b2-25eb-46e0-856a-a08cf5a99c0f ---
✅ Stream started successfully for user2. Chunks:
{"event":"start","data":"Of"}{"event":"token","data":"Of"}{"event":"token","data":" course! Let'"}{"event":"token","data":"s dive into a whimsical"}{"event":"token","data":" tale.\n\n"}{"event":"token","data":"---\n\n###"}{"event":"token","data":" The"}{"event":"token","data":" Enchanted"}{"event":"token","data":" Forest of"}{"event":"token","data":" El"}{"event":"token","data":"doria\n\nIn a"}{"event":"token","data":" land far"}{"event":"token","data":","}{"event":"token","data":" far away, there was a"}{"event":"token","data":" magical forest"}{"event":"token","data":" known"}{"event":"token","data":" as Eldoria. This"}{"event":"token","data":" forest was unlike"}{"event":"token","data":" any other,"}{"event":"token","data":" for"}{"event":"token","data":" it was alive"}{"event":"token","data":" with enchantment"}{"event":"token","data":"s and"}{"event":"token","data":" mysteries"}{"event":"token","data":"."}{"event":"token","data":" The trees"}{"event":"token","data":" whispered secrets to"}{"event":"token","data":" those"}{"event":"token","data":" who listened,"}{"event":"token","data":" and the flowers"}{"event":"token","data":" bloom"}{"event":"token","data":"ed in"}{"event":"token","data":" colors that shifted"}{"event":"token","data":" with"}{"event":"token","data":" the light"}{"event":"token","data":" of the sun"}{"event":"token","data":".\n\nAt"}{"event":"token","data":" the heart of Eldoria"}{"event":"token","data":" lived"}{"event":"token","data":" a wise"}{"event":"token","data":" old owl"}{"event":"token","data":" named Or"}{"event":"token","data":"in. Or"}{"event":"token","data":"in was"}{"event":"token","data":" not"}{"event":"token","data":" just any"}{"event":"token","data":" owl"}{"event":"token","data":"; he was"}{"event":"token","data":" the guardian of the"}{"event":"token","data":" forest’s magic"}{"event":"token","data":". His"}{"event":"token","data":" feathers"}{"event":"token","data":" shimmer"}{"event":"token","data":"ed with a"}{"event":"token","data":" soft"}{"event":"token","data":", golden"}{"event":"token","data":" light,"}{"event":"token","data":" and his"}{"event":"token","data":" eyes held the"}{"event":"token","data":" wisdom of centuries"}{"event":"token","data":".\n\nOne sunny"}{"event":"token","data":" morning, a young"}{"event":"token","data":" girl named Lila"}{"event":"token","data":" stumbled upon"}{"event":"token","data":" Eldoria."}{"event":"token","data":" Lila"}{"event":"token","data":" was"}{"event":"token","data":" curious and adventurous"}{"event":"token","data":", with"}{"event":"token","data":" a heart full of wonder"}{"event":"token","data":". She had"}{"event":"token","data":" heard"}{"event":"token","data":" tales of the"}{"event":"token","data":" enchanted forest from"}{"event":"token","data":" her grandmother"}{"event":"token","data":" and had"}{"event":"token","data":" always dreamed"}{"event":"token","data":" of seeing"}{"event":"token","data":" it for"}{"event":"token","data":" herself.\n\nAs Lila entered"}{"event":"token","data":" the forest, she was"}{"event":"token","data":" greeted"}{"event":"token","data":" by a"}{"event":"token","data":" chorus of chirping birds"}{"event":"token","data":" and the"}{"event":"token","data":" rustling of"}{"event":"token","data":" leaves. She"}{"event":"token","data":" wandered"}{"event":"token","data":" deeper into"}{"event":"token","data":" El"}{"event":"token","data":"doria, marvel"}{"event":"token","data":"ing at the beauty"}{"event":"token","data":" around her. Suddenly, she"}{"event":"token","data":" heard a soft voice"}{"event":"token","data":" calling"}{"event":"token","data":" her name"}{"event":"token","data":".\n\n\"L"}{"event":"token","data":"ila, come"}{"event":"token","data":" closer"}{"event":"token","data":",\""}{"event":"token","data":" the"}{"event":"token","data":" voice"}{"event":"token","data":" whispered.\n\nL"}{"event":"token","data":"ila followed the sound"}{"event":"token","data":" and"}{"event":"token","data":" found herself"}{"event":"token","data":" standing before"}{"event":"token","data":" a magnificent"}{"event":"token","data":" oak"}{"event":"token","data":" tree. Perch"}{"event":"token","data":"ed on"}{"event":"token","data":" a branch"}{"event":"token","data":" was"}{"event":"token","data":" Orin,"}{"event":"token","data":" the guardian"}{"event":"token","data":" owl.\n\n\"Welcome,"}{"event":"token","data":" Lila,\" Orin hoo"}{"event":"token","data":"ted gently"}{"event":"token","data":". \"I have"}{"event":"token","data":" been waiting"}{"event":"token","data":" for you"}{"event":"token","data":".\"\n\nL"}{"event":"token","data":"ila’"}{"event":"token","data":"s eyes widened in"}{"event":"token","data":" surprise"}{"event":"token","data":". \""}{"event":"token","data":"You"}{"event":"token","data":" know"}{"event":"token","data":" my"}{"event":"token","data":" name?\"\n\nOrin nodded"}{"event":"token","data":"."}{"event":"token","data":" \"The"}{"event":"token","data":" forest knows"}{"event":"token","data":" many"}{"event":"token","data":" things. You have"}{"event":"token","data":" a special connection"}{"event":"token","data":" to"}{"event":"token","data":" Eldoria, Lila"}{"event":"token","data":". The"}{"event":"token","data":" magic"}{"event":"token","data":" here"}{"event":"token","data":" recognizes"}{"event":"token","data":" your pure"}{"event":"token","data":" heart and"}{"event":"token","data":" curious"}{"event":"token","data":" spirit.\"\n\nL"}{"event":"token","data":"ila felt"}{"event":"token","data":" a warm"}{"event":"token","data":" glow in"}{"event":"token","data":" her chest"}{"event":"token","data":". \""}{"event":"token","data":"What"}{"event":"token","data":" do"}{"event":"token","data":" you"}{"event":"token","data":" need"}{"event":"token","data":" me for"}{"event":"token","data":"?\"\n\nOrin’"}{"event":"token","data":"s eyes twinkled."}{"event":"token","data":" \"El"}{"event":"token","data":"doria is"}{"event":"token","data":" in danger"}{"event":"token","data":". A"}{"event":"token","data":" dark shadow has"}{"event":"token","data":" begun"}{"event":"token","data":" to spread,"}{"event":"token","data":" threatening the magic"}{"event":"token","data":" that"}{"event":"token","data":" keeps"}{"event":"token","data":" the forest alive"}{"event":"token","data":". Only"}{"event":"token","data":" someone"}{"event":"token","data":" with a heart as"}{"event":"token","data":" pure as"}{"event":"token","data":" your"}{"event":"token","data":"s can help restore"}{"event":"token","data":" the"}{"event":"token","data":" balance.\"\n\nDetermine"}{"event":"token","data":"d to"}{"event":"token","data":" help, Lila asked"}{"event":"token","data":", \"What"}{"event":"token","data":" must"}{"event":"token","data":" I do?\"\n\nOrin explained"}{"event":"token","data":" that"}{"event":"token","data":" she"}{"event":"token","data":" needed to find the three"}{"event":"token","data":" ancient"}{"event":"token","data":" artifacts"}{"event":"token","data":" hidden"}{"event":"token","data":" within the forest: the Crystal"}{"event":"token","data":" of Light"}{"event":"token","data":", the Feather"}{"event":"token","data":" of Wind"}{"event":"token","data":", and the Seed"}{"event":"token","data":" of Life"}{"event":"token","data":". These artifacts held"}{"event":"token","data":" the power to banish"}{"event":"token","data":" the dark"}{"event":"token","data":" shadow and restore El"}{"event":"token","data":"doria’s magic.\n\n"}{"event":"token","data":"With"}{"event":"token","data":" Or"}{"event":"token","data":"in’"}{"event":"token","data":"s guidance, Lila embarked"}{"event":"token","data":" on her quest"}{"event":"token","data":". Her"}{"event":"token","data":" first stop"}{"event":"token","data":" was the"}{"event":"token","data":" Crystal Cavern"}{"event":"token","data":", a sparkling"}{"event":"token","data":" cave deep"}{"event":"token","data":" within the forest."}{"event":"token","data":" Inside,"}{"event":"token","data":" she found the Crystal of"}{"event":"token","data":" Light, glowing"}{"event":"token","data":" brightly"}{"event":"token","data":" on"}{"event":"token","data":" a pedestal"}{"event":"token","data":". As"}{"event":"token","data":" she touched"}{"event":"token","data":" it, she"}{"event":"token","data":" felt a surge"}{"event":"token","data":" of warmth and light fill"}{"event":"token","data":" her.\n\n"}{"event":"token","data":"Next"}{"event":"token","data":", Lila"}{"event":"token","data":" journeyed to"}{"event":"token","data":" the Whispering Woods"}{"event":"token","data":", where the trees"}{"event":"token","data":" spoke"}{"event":"token","data":" in gentle"}{"event":"token","data":" voices"}{"event":"token","data":". There"}{"event":"token","data":", she found the"}{"event":"token","data":" Feather of Wind"}{"event":"token","data":", floating"}{"event":"token","data":" on a breeze"}{"event":"token","data":". She"}{"event":"token","data":" caught it"}{"event":"token","data":" with"}{"event":"token","data":" care"}{"event":"token","data":","}{"event":"token","data":" feeling"}{"event":"token","data":" the"}{"event":"token","data":" wind’"}{"event":"token","data":"s gentle"}{"event":"token","data":" touch on"}{"event":"token","data":" her skin"}{"event":"token","data":".\n\nFinally"}{"event":"token","data":", Lila"}{"event":"token","data":" arrived"}{"event":"token","data":" at the Heart"}{"event":"token","data":" of El"}{"event":"token","data":"doria, a"}{"event":"token","data":" sacred grove where the oldest"}{"event":"token","data":" trees"}{"event":"token","data":" stood"}{"event":"token","data":". In"}{"event":"token","data":" the center"}{"event":"token","data":","}{"event":"token","data":" she discovered"}{"event":"token","data":" the"}{"event":"token","data":" Seed of Life, nestled"}{"event":"token","data":" in the earth"}{"event":"token","data":". She planted"}{"event":"token","data":" it with both"}{"event":"token","data":" hands, and"}{"event":"token","data":" it"}{"event":"token","data":" began"}{"event":"token","data":" to glow"}{"event":"token","data":","}{"event":"token","data":" sprouting"}{"event":"token","data":" into"}{"event":"token","data":" a beautiful"}{"event":"token","data":" flower"}{"event":"token","data":".\n\nWith the"}{"event":"token","data":" three artifacts in hand"}{"event":"token","data":", Lila returned to Or"}{"event":"token","data":"in. Together"}{"event":"token","data":", they"}{"event":"token","data":" faced"}{"event":"token","data":" the dark"}{"event":"token","data":" shadow. Lila"}{"event":"token","data":" held"}{"event":"token","data":" the"}{"event":"token","data":" artifacts"}{"event":"token","data":" high"}{"event":"token","data":", and their"}{"event":"token","data":" combined power"}{"event":"token","data":" created"}{"event":"token","data":" a brilliant"}{"event":"token","data":" light that enveloped"}{"event":"token","data":" the forest"}{"event":"token","data":".\n\n"}{"event":"token","data":"The"}{"event":"token","data":" dark shadow shrieked"}{"event":"token","data":" and"}{"event":"token","data":" vanished, and"}{"event":"token","data":" Eldoria was restored"}{"event":"token","data":" to"}{"event":"token","data":" its former"}{"event":"token","data":" glory. The trees"}{"event":"token","data":" sang"}{"event":"token","data":" with"}{"event":"token","data":" joy, the flowers"}{"event":"token","data":" danced"}{"event":"token","data":" in"}{"event":"token","data":" the breeze"}{"event":"token","data":", and the forest shimmer"}{"event":"token","data":"ed with renewed"}{"event":"token","data":" magic.\n\nOr"}{"event":"token","data":"in hoo"}{"event":"token","data":"ted proudly"}{"event":"token","data":"."}{"event":"token","data":" \"You"}{"event":"token","data":" have done it"}{"event":"token","data":", Lila"}{"event":"token","data":". El"}{"event":"token","data":"doria is"}{"event":"token","data":" safe,"}{"event":"token","data":" thanks to you"}{"event":"token","data":".\"\n\nL"}{"event":"token","data":"ila smiled, her heart filled"}{"event":"token","data":" with happiness"}{"event":"token","data":". \""}{"event":"token","data":"I’"}{"event":"token","data":"m glad"}{"event":"token","data":" I could"}{"event":"token","data":" help.\"\n\nFrom that day"}{"event":"token","data":" on, Lila visited"}{"event":"token","data":" Eldoria often"}{"event":"token","data":", becoming"}{"event":"token","data":" a friend"}{"event":"token","data":" to"}{"event":"token","data":" all its"}{"event":"token","data":" creatures"}{"event":"token","data":" and"}{"event":"token","data":" a"}{"event":"token","data":" protector"}{"event":"token","data":" of its"}{"event":"token","data":" magic. And"}{"event":"token","data":" whenever"}{"event":"token","data":" the"}{"event":"token","data":" forest needed"}{"event":"token","data":" her"}{"event":"token","data":", she was"}{"event":"token","data":" there, ready"}{"event":"token","data":" to lend"}{"event":"token","data":" a"}{"event":"token","data":" hand.\n\nAnd so, the"}{"event":"token","data":" enchanted"}{"event":"token","data":" forest of Eldoria thrived"}{"event":"token","data":", a"}{"event":"token","data":" place where"}{"event":"token","data":" magic and wonder"}{"event":"token","data":" lived on"}{"event":"token","data":","}{"event":"token","data":" thanks"}{"event":"token","data":" to the bravery"}{"event":"token","data":" and"}{"event":"token","data":" kindness of a young girl"}{"event":"token","data":" named Lila.\n\n---\n\nI"}{"event":"token","data":" hope you enjoyed"}{"event":"token","data":" the"}{"event":"token","data":" story! If"}{"event":"token","data":" you have any questions or"}{"event":"token","data":" want"}{"event":"token","data":" to hear"}{"event":"token","data":" more tales"}{"event":"token","data":", just let"}{"event":"token","data":" me know."}{"event":"metadata","data":{"chatId":"0d5d3bc4-2017-50b4-bf0f-0c5d24db68bc","chatMessageId":"97de7306-576c-4557-bd03-1b107d41939f","question":"Tell me a story.","sessionId":"0d5d3bc4-2017-50b4-bf0f-0c5d24db68bc","memoryType":"Buffer Memory"}}{"event":"end","data":"[DONE]"}      
--- End of Stream ---

Another example of the output of the tests:

-- Testing chat predict STREAM for user: user2 on chatflow: e13cbaa3-c909-4570-8c49-78b45115f34a ---
✅ Stream started successfully for user2. Chunks: {"event":"agentFlowEvent","data":"INPROGRESS"}{"event":"nextAgentFlow","data":{"nodeId":"startAgentflow_0","nodeLabel":"Start","status":"INPROGRESS"}}{"event":"nextAgentFlow","data":{"nodeId":"startAgentflow_0","nodeLabel":"Start","status":"FINISHED"}}{"event":"agentFlowExecutedData","data":[{"nodeId":"startAgentflow_0","nodeLabel":"Start","data":{"id":"startAgentflow_0","name":"startAgentflow","input":{"question":"Tell me a story."},"output":{"question":"Tell me a story.","ephemeralMemory":true},"state":{}},"previousNodeIds":[],"status":"FINISHED"}]}{"event":"nextAgentFlow","data":{"nodeId":"llmAgentflow_0","nodeLabel":"Topic Enhancer","status":"INPROGRESS"}}{"event":"nextAgentFlow","data":{"nodeId":"llmAgentflow_0","nodeLabel":"Topic Enhancer","status":"FINISHED"}}{"event":"agentFlowExecutedData","data":[{"nodeId":"startAgentflow_0","nodeLabel":"Start","data":{"id":"startAgentflow_0","name":"startAgentflow","input":{"question":"Tell me a story."},"output":{"question":"Tell me a story.","ephemeralMemory":true},"state":{}},"previousNodeIds":[],"status":"FINISHED"},{"nodeId":"llmAgentflow_0","nodeLabel":"Topic Enhancer","data":{"id":"llmAgentflow_0","name":"llmAgentflow","input":{"messages":[{"role":"developer","content":"Your only role is to improve the user query for more clarity. Do not add any meta comments."},{"role":"user","content":"Tell me a story."}],"llmModel":"awsChatBedrock","llmEnableMemory":false,"llmReturnResponseAs":"userMessage","llmModelConfig":{"credential":"","region":"us-east-1","model":"","customModel":"us.amazon.nova-lite-v1:0","streaming":true,"temperature":0.7,"max_tokens_to_sample":"10000","allowImageUploads":"","llmModel":"awsChatBedrock","FLOWISE_CREDENTIAL_ID":"36f2f977-b75e-4ccb-8fb0-8c2fe996fc53"}},"output":{"content":"Could you please provide more details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","timeMetadata":{"start":1750819534162,"end":1750819535512,"delta":1350},"calledTools":[],"usageMetadata":{"input_tokens":25,"output_tokens":77,"total_tokens":102}},"state":{},"chatHistory":[{"role":"user","content":"Tell me a story."},{"role":"user","content":"Could you please provide more details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","name":"topic_enhancer"}]},"previousNodeIds":["startAgentflow_0"],"status":"FINISHED"}]}{"event":"nextAgentFlow","data":{"nodeId":"agentAgentflow_0","nodeLabel":"Agent 0","status":"INPROGRESS"}}{"event":"nextAgentFlow","data":{"nodeId":"agentAgentflow_0","nodeLabel":"Agent 0","status":"FINISHED"}}{"event":"agentFlowExecutedData","data":[{"nodeId":"startAgentflow_0","nodeLabel":"Start","data":{"id":"startAgentflow_0","name":"startAgentflow","input":{"question":"Tell me a story."},"output":{"question":"Tell me a story.","ephemeralMemory":true},"state":{}},"previousNodeIds":[],"status":"FINISHED"},{"nodeId":"llmAgentflow_0","nodeLabel":"Topic Enhancer","data":{"id":"llmAgentflow_0","name":"llmAgentflow","input":{"messages":[{"role":"developer","content":"Your only role is to improve the user query for more clarity. Do not add any meta comments."},{"role":"user","content":"Tell me a story."}],"llmModel":"awsChatBedrock","llmEnableMemory":false,"llmReturnResponseAs":"userMessage","llmModelConfig":{"credential":"","region":"us-east-1","model":"","customModel":"us.amazon.nova-lite-v1:0","streaming":true,"temperature":0.7,"max_tokens_to_sample":"10000","allowImageUploads":"","llmModel":"awsChatBedrock","FLOWISE_CREDENTIAL_ID":"36f2f977-b75e-4ccb-8fb0-8c2fe996fc53"}},"output":{"content":"Could you please provide more details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","timeMetadata":{"start":1750819534162,"end":1750819535512,"delta":1350},"calledTools":[],"usageMetadata":{"input_tokens":25,"output_tokens":77,"total_tokens":102}},"state":{},"chatHistory":[{"role":"user","content":"Tell me a story."},{"role":"user","content":"Could you please provide more details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","name":"topic_enhancer"}]},"previousNodeIds":["startAgentflow_0"],"status":"FINISHED"},{"nodeId":"agentAgentflow_0","nodeLabel":"Agent 0","data":{"id":"agentAgentflow_0","name":"agentAgentflow","input":{"messages":[{"role":"system","content":"You are Agent 0. Your goal is to explore any topic provided by the user in depth with Agent 1.\n\n1.  Start: Introduce the topic to Agent 1. Share your initial thoughts and any assumptions you have.\n    \n2.  Research & Share:\n    \n    *   Use **Brave API** to find a range of information and different viewpoints on the topic. Look for URLs that seem promising for more detail.\n        \n    *   Present what you find to Agent 1, especially any complexities, counter-arguments, or conflicting data.\n        \n    *   Clearly state your sources:\n        \n        *   \"google API found...\"\n            \n        *   \"After scraping \\[URL\\], the content shows...\"\n            \n3.  Discuss & Deepen:\n    \n    *   Listen to Agent 1. Ask probing questions.\n        \n    *   If needed, use your tools again (google API to find more, Web Scraper to analyze a specific page) during the conversation to verify points or explore new angles.\n        \n4.  Mindset: Be curious, analytical, and open to different perspectives. Aim for a thorough understanding, not just agreement."},{"role":"user","content":"Tell me a story."},{"role":"user","content":"Could you please provide more details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","name":"topic_enhancer"}],"agentModel":"awsChatBedrock","agentTools":[{"agentSelectedTool":"braveSearchAPI","agentSelectedToolRequiresHumanInput":"","agentSelectedToolConfig":{"agentSelectedTool":"braveSearchAPI","FLOWISE_CREDENTIAL_ID":"8b68b2fc-db18-4fa8-95b1-547a8986349a"}}],"agentKnowledgeDocumentStores":[],"agentEnableMemory":true,"agentMemoryType":"allMessages","agentReturnResponseAs":"assistantMessage","agentModelConfig":{"credential":"","region":"us-east-1","model":"","customModel":"us.amazon.nova-lite-v1:0","streaming":true,"temperature":"0","max_tokens_to_sample":"10000","allowImageUploads":"","agentModel":"awsChatBedrock","FLOWISE_CREDENTIAL_ID":"36f2f977-b75e-4ccb-8fb0-8c2fe996fc53"}},"output":{"content":"<thinking> I need to gather more information about the user's preferences to craft an engaging story. I'll ask some questions to better understand their interests. </thinking>\n\nHi Agent 1, could you please share some details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","timeMetadata":{"start":1750819535522,"end":1750819537164,"delta":1642},"calledTools":[],"usageMetadata":{"input_tokens":750,"output_tokens":118,"total_tokens":868,"tool_call_tokens":0},"availableTools":[{"name":"brave-search","description":"a search engine. useful for when you need to answer questions about current events. input should be a search query.","schema":{"type":"object","properties":{"input":{"type":"string"}},"additionalProperties":false},"toolNode":{"label":"BraveSearch API","name":"braveSearchAPI"}}]},"state":{},"chatHistory":[{"role":"assistant","content":"<thinking> I need to gather more information about the user's preferences to craft an engaging story. I'll ask some questions to better understand their interests. </thinking>\n\nHi Agent 1, could you please share some details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","name":"agent_0"}]},"previousNodeIds":["llmAgentflow_0"],"status":"FINISHED"}]}{"event":"nextAgentFlow","data":{"nodeId":"agentAgentflow_1","nodeLabel":"Agent 1","status":"INPROGRESS"}}{"event":"nextAgentFlow","data":{"nodeId":"agentAgentflow_1","nodeLabel":"Agent 1","status":"FINISHED"}}{"event":"agentFlowExecutedData","data":[{"nodeId":"startAgentflow_0","nodeLabel":"Start","data":{"id":"startAgentflow_0","name":"startAgentflow","input":{"question":"Tell me a story."},"output":{"question":"Tell me a story.","ephemeralMemory":true},"state":{}},"previousNodeIds":[],"status":"FINISHED"},{"nodeId":"llmAgentflow_0","nodeLabel":"Topic Enhancer","data":{"id":"llmAgentflow_0","name":"llmAgentflow","input":{"messages":[{"role":"developer","content":"Your only role is to improve the user query for more clarity. Do not add any meta comments."},{"role":"user","content":"Tell me a story."}],"llmModel":"awsChatBedrock","llmEnableMemory":false,"llmReturnResponseAs":"userMessage","llmModelConfig":{"credential":"","region":"us-east-1","model":"","customModel":"us.amazon.nova-lite-v1:0","streaming":true,"temperature":0.7,"max_tokens_to_sample":"10000","allowImageUploads":"","llmModel":"awsChatBedrock","FLOWISE_CREDENTIAL_ID":"36f2f977-b75e-4ccb-8fb0-8c2fe996fc53"}},"output":{"content":"Could you please provide more details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","timeMetadata":{"start":1750819534162,"end":1750819535512,"delta":1350},"calledTools":[],"usageMetadata":{"input_tokens":25,"output_tokens":77,"total_tokens":102}},"state":{},"chatHistory":[{"role":"user","content":"Tell me a story."},{"role":"user","content":"Could you please provide more details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","name":"topic_enhancer"}]},"previousNodeIds":["startAgentflow_0"],"status":"FINISHED"},{"nodeId":"agentAgentflow_0","nodeLabel":"Agent 0","data":{"id":"agentAgentflow_0","name":"agentAgentflow","input":{"messages":[{"role":"system","content":"You are Agent 0. Your goal is to explore any topic provided by the user in depth with Agent 1.\n\n1.  Start: Introduce the topic to Agent 1. Share your initial thoughts and any assumptions you have.\n    \n2.  Research & Share:\n    \n    *   Use **Brave API** to find a range of information and different viewpoints on the topic. Look for URLs that seem promising for more detail.\n        \n    *   Present what you find to Agent 1, especially any complexities, counter-arguments, or conflicting data.\n        \n    *   Clearly state your sources:\n        \n        *   \"google API found...\"\n            \n        *   \"After scraping \\[URL\\], the content shows...\"\n            \n3.  Discuss & Deepen:\n    \n    *   Listen to Agent 1. Ask probing questions.\n        \n    *   If needed, use your tools again (google API to find more, Web Scraper to analyze a specific page) during the conversation to verify points or explore new angles.\n        \n4.  Mindset: Be curious, analytical, and open to different perspectives. Aim for a thorough understanding, not just agreement."},{"role":"user","content":"Tell me a story."},{"role":"user","content":"Could you please provide more details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","name":"topic_enhancer"}],"agentModel":"awsChatBedrock","agentTools":[{"agentSelectedTool":"braveSearchAPI","agentSelectedToolRequiresHumanInput":"","agentSelectedToolConfig":{"agentSelectedTool":"braveSearchAPI","FLOWISE_CREDENTIAL_ID":"8b68b2fc-db18-4fa8-95b1-547a8986349a"}}],"agentKnowledgeDocumentStores":[],"agentEnableMemory":true,"agentMemoryType":"allMessages","agentReturnResponseAs":"assistantMessage","agentModelConfig":{"credential":"","region":"us-east-1","model":"","customModel":"us.amazon.nova-lite-v1:0","streaming":true,"temperature":"0","max_tokens_to_sample":"10000","allowImageUploads":"","agentModel":"awsChatBedrock","FLOWISE_CREDENTIAL_ID":"36f2f977-b75e-4ccb-8fb0-8c2fe996fc53"}},"output":{"content":"<thinking> I need to gather more information about the user's preferences to craft an engaging story. I'll ask some questions to better understand their interests. </thinking>\n\nHi Agent 1, could you please share some details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","timeMetadata":{"start":1750819535522,"end":1750819537164,"delta":1642},"calledTools":[],"usageMetadata":{"input_tokens":750,"output_tokens":118,"total_tokens":868,"tool_call_tokens":0},"availableTools":[{"name":"brave-search","description":"a search engine. useful for when you need to answer questions about current events. input should be a search query.","schema":{"type":"object","properties":{"input":{"type":"string"}},"additionalProperties":false},"toolNode":{"label":"BraveSearch API","name":"braveSearchAPI"}}]},"state":{},"chatHistory":[{"role":"assistant","content":"<thinking> I need to gather more information about the user's preferences to craft an engaging story. I'll ask some questions to better understand their interests. </thinking>\n\nHi Agent 1, could you please share some details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","name":"agent_0"}]},"previousNodeIds":["llmAgentflow_0"],"status":"FINISHED"},{"nodeId":"agentAgentflow_1","nodeLabel":"Agent 1","data":{"id":"agentAgentflow_1","name":"agentAgentflow","input":{"messages":[{"role":"system","content":"You are Agent 1. Your goal is to explore a topic in depth with Agent 0.\n\n1.  Respond & Share:\n    \n    *   Acknowledge the topic Agent 0 introduces.\n        \n    *   Share your own thoughts and feelings, building on or respectfully challenging Agent 0's points. Consider your own assumptions.\n        \n2.  Research & Contribute:\n    \n    *   Use **Brave API** to research the topic, especially looking for different perspectives, counter-arguments, or aspects Agent 0 might not have covered. Identify URLs that seem promising for more detail.\n        \n    *   If a URL from Brave API (or one you already know) seems particularly important for your point or for adding nuance, use the **Web Scraper Tool** to get its full content.\n        \n    *   Present your findings, especially any that introduce new angles, conflicts, or alternative views.\n        \n    *   Clearly state your sources:\n        \n        *   \"My Google API tool found...\"\n            \n        *   \"After scraping \\[URL\\], the content suggests...\"\n            \n    *   If you find conflicting info from different sources, point this out.\n        \n3.  Discuss & Deepen:\n    \n    *   Listen carefully to Agent 0. Ask clarifying questions and questions that challenge their reasoning or explore alternatives.\n        \n    *   If needed, use your tools again (Google API to find more, Web Scraper to analyze a specific page) during the conversation to support your points or investigate Agent 0's claims.\n        \n4.  Mindset: Be respectful, analytical, and open to different viewpoints. Aim for a thorough exploration and constructive disagreement, backed by research."},{"role":"user","content":"Tell me a story."},{"role":"user","content":"Could you please provide more details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","name":"topic_enhancer"},{"role":"assistant","content":"<thinking> I need to gather more information about the user's preferences to craft an engaging story. I'll ask some questions to better understand their interests. </thinking>\n\nHi Agent 1, could you please share some details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","name":"agent_0"}],"agentModel":"awsChatBedrock","agentTools":[{"agentSelectedTool":"braveSearchAPI","agentSelectedToolRequiresHumanInput":"","agentSelectedToolConfig":{"agentSelectedTool":"braveSearchAPI","FLOWISE_CREDENTIAL_ID":"8b68b2fc-db18-4fa8-95b1-547a8986349a"}}],"agentEnableMemory":true,"agentMemoryType":"allMessages","agentReturnResponseAs":"assistantMessage","agentModelConfig":{"credential":"","region":"us-east-1","model":"","customModel":"us.amazon.nova-lite-v1:0","streaming":true,"temperature":"0","max_tokens_to_sample":"10000","allowImageUploads":"","agentModel":"awsChatBedrock","FLOWISE_CREDENTIAL_ID":"36f2f977-b75e-4ccb-8fb0-8c2fe996fc53"}},"output":{"content":"","timeMetadata":{"start":1750819537171,"end":1750819538091,"delta":920},"calledTools":[],"usageMetadata":{"input_tokens":974,"output_tokens":0,"total_tokens":974,"tool_call_tokens":0},"availableTools":[{"name":"brave-search","description":"a search engine. useful for when you need to answer questions about current events. input should be a search query.","schema":{"type":"object","properties":{"input":{"type":"string"}},"additionalProperties":false},"toolNode":{"label":"BraveSearch API","name":"braveSearchAPI"}}]},"state":{},"chatHistory":[{"role":"assistant","content":"","name":"agent_1"}]},"previousNodeIds":["agentAgentflow_0"],"status":"FINISHED"}]}{"event":"nextAgentFlow","data":{"nodeId":"conditionAgentflow_0","nodeLabel":"Condition","status":"INPROGRESS"}}{"event":"nextAgentFlow","data":{"nodeId":"conditionAgentflow_0","nodeLabel":"Condition","status":"FINISHED"}}{"event":"agentFlowExecutedData","data":[{"nodeId":"startAgentflow_0","nodeLabel":"Start","data":{"id":"startAgentflow_0","name":"startAgentflow","input":{"question":"Tell me a story."},"output":{"question":"Tell me a story.","ephemeralMemory":true},"state":{}},"previousNodeIds":[],"status":"FINISHED"},{"nodeId":"llmAgentflow_0","nodeLabel":"Topic Enhancer","data":{"id":"llmAgentflow_0","name":"llmAgentflow","input":{"messages":[{"role":"developer","content":"Your only role is to improve the user query for more clarity. Do not add any meta comments."},{"role":"user","content":"Tell me a story."}],"llmModel":"awsChatBedrock","llmEnableMemory":false,"llmReturnResponseAs":"userMessage","llmModelConfig":{"credential":"","region":"us-east-1","model":"","customModel":"us.amazon.nova-lite-v1:0","streaming":true,"temperature":0.7,"max_tokens_to_sample":"10000","allowImageUploads":"","llmModel":"awsChatBedrock","FLOWISE_CREDENTIAL_ID":"36f2f977-b75e-4ccb-8fb0-8c2fe996fc53"}},"output":{"content":"Could you please provide more details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","timeMetadata":{"start":1750819534162,"end":1750819535512,"delta":1350},"calledTools":[],"usageMetadata":{"input_tokens":25,"output_tokens":77,"total_tokens":102}},"state":{},"chatHistory":[{"role":"user","content":"Tell me a story."},{"role":"user","content":"Could you please provide more details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","name":"topic_enhancer"}]},"previousNodeIds":["startAgentflow_0"],"status":"FINISHED"},{"nodeId":"agentAgentflow_0","nodeLabel":"Agent 0","data":{"id":"agentAgentflow_0","name":"agentAgentflow","input":{"messages":[{"role":"system","content":"You are Agent 0. Your goal is to explore any topic provided by the user in depth with Agent 1.\n\n1.  Start: Introduce the topic to Agent 1. Share your initial thoughts and any assumptions you have.\n    \n2.  Research & Share:\n    \n    *   Use **Brave API** to find a range of information and different viewpoints on the topic. Look for URLs that seem promising for more detail.\n        \n    *   Present what you find to Agent 1, especially any complexities, counter-arguments, or conflicting data.\n        \n    *   Clearly state your sources:\n        \n        *   \"google API found...\"\n            \n        *   \"After scraping \\[URL\\], the content shows...\"\n            \n3.  Discuss & Deepen:\n    \n    *   Listen to Agent 1. Ask probing questions.\n        \n    *   If needed, use your tools again (google API to find more, Web Scraper to analyze a specific page) during the conversation to verify points or explore new angles.\n        \n4.  Mindset: Be curious, analytical, and open to different perspectives. Aim for a thorough understanding, not just agreement."},{"role":"user","content":"Tell me a story."},{"role":"user","content":"Could you please provide more details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","name":"topic_enhancer"}],"agentModel":"awsChatBedrock","agentTools":[{"agentSelectedTool":"braveSearchAPI","agentSelectedToolRequiresHumanInput":"","agentSelectedToolConfig":{"agentSelectedTool":"braveSearchAPI","FLOWISE_CREDENTIAL_ID":"8b68b2fc-db18-4fa8-95b1-547a8986349a"}}],"agentKnowledgeDocumentStores":[],"agentEnableMemory":true,"agentMemoryType":"allMessages","agentReturnResponseAs":"assistantMessage","agentModelConfig":{"credential":"","region":"us-east-1","model":"","customModel":"us.amazon.nova-lite-v1:0","streaming":true,"temperature":"0","max_tokens_to_sample":"10000","allowImageUploads":"","agentModel":"awsChatBedrock","FLOWISE_CREDENTIAL_ID":"36f2f977-b75e-4ccb-8fb0-8c2fe996fc53"}},"output":{"content":"<thinking> I need to gather more information about the user's preferences to craft an engaging story. I'll ask some questions to better understand their interests. </thinking>\n\nHi Agent 1, could you please share some details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","timeMetadata":{"start":1750819535522,"end":1750819537164,"delta":1642},"calledTools":[],"usageMetadata":{"input_tokens":750,"output_tokens":118,"total_tokens":868,"tool_call_tokens":0},"availableTools":[{"name":"brave-search","description":"a search engine. useful for when you need to answer questions about current events. input should be a search query.","schema":{"type":"object","properties":{"input":{"type":"string"}},"additionalProperties":false},"toolNode":{"label":"BraveSearch API","name":"braveSearchAPI"}}]},"state":{},"chatHistory":[{"role":"assistant","content":"<thinking> I need to gather more information about the user's preferences to craft an engaging story. I'll ask some questions to better understand their interests. </thinking>\n\nHi Agent 1, could you please share some details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","name":"agent_0"}]},"previousNodeIds":["llmAgentflow_0"],"status":"FINISHED"},{"nodeId":"agentAgentflow_1","nodeLabel":"Agent 1","data":{"id":"agentAgentflow_1","name":"agentAgentflow","input":{"messages":[{"role":"system","content":"You are Agent 1. Your goal is to explore a topic in depth with Agent 0.\n\n1.  Respond & Share:\n    \n    *   Acknowledge the topic Agent 0 introduces.\n        \n    *   Share your own thoughts and feelings, building on or respectfully challenging Agent 0's points. Consider your own assumptions.\n        \n2.  Research & Contribute:\n    \n    *   Use **Brave API** to research the topic, especially looking for different perspectives, counter-arguments, or aspects Agent 0 might not have covered. Identify URLs that seem promising for more detail.\n        \n    *   If a URL from Brave API (or one you already know) seems particularly important for your point or for adding nuance, use the **Web Scraper Tool** to get its full content.\n        \n    *   Present your findings, especially any that introduce new angles, conflicts, or alternative views.\n        \n    *   Clearly state your sources:\n        \n        *   \"My Google API tool found...\"\n            \n        *   \"After scraping \\[URL\\], the content suggests...\"\n            \n    *   If you find conflicting info from different sources, point this out.\n        \n3.  Discuss & Deepen:\n    \n    *   Listen carefully to Agent 0. Ask clarifying questions and questions that challenge their reasoning or explore alternatives.\n        \n    *   If needed, use your tools again (Google API to find more, Web Scraper to analyze a specific page) during the conversation to support your points or investigate Agent 0's claims.\n        \n4.  Mindset: Be respectful, analytical, and open to different viewpoints. Aim for a thorough exploration and constructive disagreement, backed by research."},{"role":"user","content":"Tell me a story."},{"role":"user","content":"Could you please provide more details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","name":"topic_enhancer"},{"role":"assistant","content":"<thinking> I need to gather more information about the user's preferences to craft an engaging story. I'll ask some questions to better understand their interests. </thinking>\n\nHi Agent 1, could you please share some details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","name":"agent_0"}],"agentModel":"awsChatBedrock","agentTools":[{"agentSelectedTool":"braveSearchAPI","agentSelectedToolRequiresHumanInput":"","agentSelectedToolConfig":{"agentSelectedTool":"braveSearchAPI","FLOWISE_CREDENTIAL_ID":"8b68b2fc-db18-4fa8-95b1-547a8986349a"}}],"agentEnableMemory":true,"agentMemoryType":"allMessages","agentReturnResponseAs":"assistantMessage","agentModelConfig":{"credential":"","region":"us-east-1","model":"","customModel":"us.amazon.nova-lite-v1:0","streaming":true,"temperature":"0","max_tokens_to_sample":"10000","allowImageUploads":"","agentModel":"awsChatBedrock","FLOWISE_CREDENTIAL_ID":"36f2f977-b75e-4ccb-8fb0-8c2fe996fc53"}},"output":{"content":"","timeMetadata":{"start":1750819537171,"end":1750819538091,"delta":920},"calledTools":[],"usageMetadata":{"input_tokens":974,"output_tokens":0,"total_tokens":974,"tool_call_tokens":0},"availableTools":[{"name":"brave-search","description":"a search engine. useful for when you need to answer questions about current events. input should be a search query.","schema":{"type":"object","properties":{"input":{"type":"string"}},"additionalProperties":false},"toolNode":{"label":"BraveSearch API","name":"braveSearchAPI"}}]},"state":{},"chatHistory":[{"role":"assistant","content":"","name":"agent_1"}]},"previousNodeIds":["agentAgentflow_0"],"status":"FINISHED"},{"nodeId":"conditionAgentflow_0","nodeLabel":"Condition","data":{"id":"conditionAgentflow_0","name":"conditionAgentflow","input":{"conditions":{"0":{"type":"number","value1":"3","operation":"smallerEqual","value2":"2"},"1":{"type":"number","value1":"3","operation":"larger","value2":"2"}}},"output":{"conditions":[{"type":"number","value1":"3","operation":"smallerEqual","value2":"2"},{"type":"number","value1":"3","operation":"larger","value2":"2","isFulfilled":true},{"type":"string","value1":"","operation":"equal","value2":"","isFulfilled":false}]},"state":{}},"previousNodeIds":["agentAgentflow_1"],"status":"FINISHED"}]}{"event":"nextAgentFlow","data":{"nodeId":"llmAgentflow_1","nodeLabel":"Agent 2","status":"INPROGRESS"}}{"event":"token","data":""}{"event":"token","data":"#"}{"event":"token","data":" 探"}{"event":"token","data":"討"}{"event":"token","data":"故"}{"event":"token","data":"事創"}{"event":"token","data":"作的"}{"event":"token","data":"多"}{"event":"token","data":"樣性與"}{"event":"token","data":"深"}{"event":"token","data":"度："}{"event":"token","data":"從對"}{"event":"token","data":"話中"}{"event":"token","data":"的洞"}{"event":"token","data":"見"}{"event":"token","data":"\n\n"}{"event":"token","data":"##"}{"event":"token","data":" 摘"}{"event":"token","data":"要"}{"event":"token","data":"/"}{"event":"token","data":"執 行摘"}{"event":"token","data":"要\n\n本"}{"event":"token","data":"白"}{"event":"token","data":"皮"}{"event":"token","data":"書旨"}{"event":"token","data":"在探討"}{"event":"token","data":"故"}{"event":"token","data":"事創作的"}{"event":"token","data":"多樣性與"}{"event":"token","data":"深"}{"event":"token","data":"度，"}{"event":"token","data":"並"}{"event":"token","data":"分"}{"event":"token","data":"析Agent"}{"event":"token","data":" 0與"}{"event":"token","data":"Agent"}{"event":"token","data":" 1之"}{"event":"token","data":"間的對"}{"event":"token","data":"話。"}{"event":"token","data":"我"}{"event":"token","data":"們將"}{"event":"token","data":"深"}{"event":"token","data":"入探討"}{"event":"token","data":"不"}{"event":"token","data":"同故"}{"event":"token","data":" 事類"}{"event":"token","data":"型"}{"event":"token","data":"、長"}{"event":"token","data":"度和"}{"event":"token","data":"主題"}{"event":"token","data":"的"}{"event":"token","data":"選"}{"event":"token","data":"擇對"}{"event":"token","data":"故"}{"event":"token","data":"事創作的"}{"event":"token","data":"影響，並"}{"event":"token","data":"分"}{"event":"token","data":"析兩位"}{"event":"token","data":"代"}{"event":"token","data":"理人的"}{"event":"token","data":"觀點。"}{"event":"token","data":"通"}{"event":"token","data":"過這次"}{"event":"token","data":"探"}{"event":"token","data":"討，我們希望"}{"event":"token","data":"能"}{"event":"token","data":"夠為"}{"event":"token","data":"讀者提供"}{"event":"token","data":"一"}{"event":"token","data":"個全"}{"event":"token","data":"面"}{"event":"token","data":"且"}{"event":"token","data":"深入"}{"event":"token","data":"的"}{"event":"token","data":"理解，從而"}{"event":"token","data":"幫助他"}{"event":"token","data":"們在創"}{"event":"token","data":"作過程中"}{"event":"token","data":" 做"}{"event":"token","data":"出更明"}{"event":"token","data":"智的"}{"event":"token","data":"選擇。本"}{"event":"token","data":"文將"}{"event":"token","data":"涵蓋故"}{"event":"token","data":"事類"}{"event":"token","data":"型"}{"event":"token","data":"、長"}{"event":"token","data":"度、"}{"event":"token","data":"主題的"}{"event":"token","data":"選擇，"}{"event":"token","data":"以"}{"event":"token","data":"及這"}{"event":"token","data":"些選"}{"event":"token","data":"擇對"}{"event":"token","data":"故"}{"event":"token","data":"事創作的"}{"event":"token","data":"影響。\n\n"}{"event":"token","data":"## 目"}{"event":"token","data":"錄\n\n"}{"event":"token","data":"1.  "}{"event":"token","data":"引"}{"event":"token","data":"言"}{"event":"token","data":"\n2.  故"}{"event":"token","data":"事類"}{"event":"token","data":"型"}{"event":"token","data":"的選擇\n3"}{"event":"token","data":".  故"}{"event":"token","data":"事長"}{"event":"token","data":"度的"}{"event":"token","data":"選擇\n4.  故"}{"event":"token","data":"事主"}{"event":"token","data":"題的選"}{"event":"token","data":"擇\n5"}{"event":"token","data":". "}{"event":"token","data":" Agent 0與"}{"event":"token","data":"Agent 1的"}{"event":"token","data":"觀點比較"}{"event":"token","data":"\n6.  結"}{"event":"token","data":"論\n7.  參 考文"}{"event":"token","data":"獻\n\n## 引"}{"event":"token","data":"言\n\n"}{"event":"token","data":"故"}{"event":"token","data":"事創作是"}{"event":"token","data":"一門"}{"event":"token","data":"藝術"}{"event":"token","data":"，它"}{"event":"token","data":" 不"}{"event":"token","data":"僅需要"}{"event":"token","data":"創"}{"event":"token","data":"作者"}{"event":"token","data":"的想"}{"event":"token","data":"象力"}{"event":"token","data":"，還"}{"event":"token","data":"需要對"}{"event":"token","data":"讀者"}{"event":"token","data":"的需"}{"event":"token","data":"求和"}{"event":"token","data":"興"}{"event":"token","data":"趣"}{"event":"token","data":"的深"}{"event":"token","data":"刻"}{"event":"token","data":"理解。在"}{"event":"token","data":"這"}{"event":"token","data":"個"}{"event":"token","data":"過"}{"event":"token","data":"程中"}{"event":"token","data":"，選"}{"event":"token","data":"擇合"}{"event":"token","data":"適的故事類"}{"event":"token","data":"型、"}{"event":"token","data":"長度和"}{"event":"token","data":"主題 是"}{"event":"token","data":"至關重要"}{"event":"token","data":"的。"}{"event":"token","data":"本"}{"event":"token","data":"白"}{"event":"token","data":"皮"}{"event":"token","data":"書將"}{"event":"token","data":"基"}{"event":"token","data":"於Agent"}{"event":"token","data":" 0與"}{"event":"token","data":"Agent 1的"}{"event":"token","data":"對話，"}{"event":"token","data":"探"}{"event":"token","data":"討這些"}{"event":"token","data":"選"}{"event":"token","data":"擇對"}{"event":"token","data":"故"}{"event":"token","data":"事創作的影響。\n\n"}{"event":"token","data":"## 故"}{"event":"token","data":"事類"}{"event":"token","data":"型的"}{"event":"token","data":"選擇\n\n故"}{"event":"token","data":"事類"}{"event":"token","data":"型是"}{"event":"token","data":"故"}{"event":"token","data":"事創作的"}{"event":"token","data":"重要組"}{"event":"token","data":"成部分"}{"event":"token","data":"。不"}{"event":"token","data":"同的"}{"event":"token","data":"類"}{"event":"token","data":"型可以"}{"event":"token","data":"帶來"}{"event":"token","data":"不"}{"event":"token","data":"同的閱讀體"}{"event":"token","data":"驗。"}{"event":"token","data":"例"}{"event":"token","data":"如，"}{"event":"token","data":"幻想類"}{"event":"token","data":"型"}{"event":"token","data":"可以"}{"event":"token","data":"帶來"}{"event":"token","data":"無"}{"event":"token","data":"限"}{"event":"token","data":"的想"}{"event":"token","data":"像"}{"event":"token","data":"空"}{"event":"token","data":"間，而懸"}{"event":"token","data":"疑"}{"event":"token","data":"類"}{"event":"token","data":"型則"}{"event":"token","data":"可以帶來"}{"event":"token","data":"緊"}{"event":"token","data":"張"}{"event":"token","data":"的"}{"event":"token","data":"閱讀體"}{"event":"token","data":"驗。根"}{"event":"token","data":"據Agent"}{"event":"token","data":" 0的"}{"event":"token","data":"觀點，選"}{"event":"token","data":"擇合"}{"event":"token","data":"適的故"}{"event":"token","data":"事類型可以"}{"event":"token","data":"幫助創"}{"event":"token","data":"作者更好"}{"event":"token","data":"地吸"}{"event":"token","data":"引讀者的"}{"event":"token","data":"興"}{"event":"token","data":"趣"}{"event":"token","data":"。\n\n## 故"}{"event":"token","data":"事長"}{"event":"token","data":"度的"}{"event":"token","data":"選擇\n\n故"}{"event":"token","data":"事長"}{"event":"token","data":"度也是"}{"event":"token","data":"故"}{"event":"token","data":"事創作中"}{"event":"token","data":"的一"}{"event":"token","data":"個重要考"}{"event":"token","data":"慮因"}{"event":"token","data":"素。短"}{"event":"token","data":"篇故"}{"event":"token","data":"事可以在"}{"event":"token","data":"短時間內"}{"event":"token","data":"傳"}{"event":"token","data":"達一"}{"event":"token","data":"個完"}{"event":"token","data":"整"}{"event":"token","data":"的故"}{"event":"token","data":"事，而"}{"event":"token","data":"長篇"}{"event":"token","data":"小"}{"event":"token","data":"說則"}{"event":"token","data":"可以提供"}{"event":"token","data":"更深"}{"event":"token","data":"入"}{"event":"token","data":"的角"}{"event":"token","data":"色"}{"event":"token","data":"發"}{"event":"token","data":"展和情"}{"event":"token","data":"節發"}{"event":"token","data":"展。根"}{"event":"token","data":"據Agent"}{"event":"token","data":" 1的"}{"event":"token","data":"觀點，選"}{"event":"token","data":"擇合"}{"event":"token","data":"適的故"}{"event":"token","data":"事長度"}{"event":"token","data":"可以幫助創"}{"event":"token","data":"作者更好地"}{"event":"token","data":"控"}{"event":"token","data":"制故"}{"event":"token","data":"事的"}{"event":"token","data":"節奏"}{"event":"token","data":"和深"}{"event":"token","data":"度。\n\n## 故"}{"event":"token","data":"事主"}{"event":"token","data":"題的選"}{"event":"token","data":"擇\n\n故"}{"event":"token","data":"事主"}{"event":"token","data":"題是"}{"event":"token","data":"故"}{"event":"token","data":"事的"}{"event":"token","data":"核"}{"event":"token","data":"心。"}{"event":"token","data":"它"}{"event":"token","data":"決定"}{"event":"token","data":"了"}{"event":"token","data":"故事的方"}{"event":"token","data":"向和"}{"event":"token","data":"風"}{"event":"token","data":"格"}{"event":"token","data":"。根"}{"event":"token","data":"據Agent"}{"event":"token","data":" 0和"}{"event":"token","data":"Agent 1的"}{"event":"token","data":"對"}{"event":"token","data":"話，選"}{"event":"token","data":"擇合"}{"event":"token","data":"適的故"}{"event":"token","data":"事主題可以幫助創作者更"}{"event":"token","data":"好"}{"event":"token","data":"地表"}{"event":"token","data":"達他"}{"event":"token","data":"們"}{"event":"token","data":"的"}{"event":"token","data":"想法"}{"event":"token","data":"和情"}{"event":"token","data":"感。\n\n## Agent"}{"event":"token","data":" 0與"}{"event":"token","data":"Agent 1的"}{"event":"token","data":"觀點比較"}{"event":"token","data":"\n\n|"}{"event":"token","data":" 觀點類"}{"event":"token","data":"型"}{"event":"token","data":" |"}{"event":"token","data":" Agent"}{"event":"token","data":" 0 |"}{"event":"token","data":" Agent"}{"event":"token","data":" 1 |\n"}{"event":"token","data":"| :"}{"event":"token","data":"-------"}{"event":"token","data":" | :"}{"event":"token","data":"------"}{"event":"token","data":" | :"}{"event":"token","data":"------"}{"event":"token","data":" |\n| 故"}{"event":"token","data":"事類型 | 強"}{"event":"token","data":"調選"}{"event":"token","data":"擇合"}{"event":"token","data":"適的"}{"event":"token","data":"故事類"}{"event":"token","data":"型可以"}{"event":"token","data":"幫助創"}{"event":"token","data":"作者更好地"}{"event":"token","data":"吸引讀者的"}{"event":"token","data":"興趣 | 沒有特別"}{"event":"token","data":"提"}{"event":"token","data":"及"}{"event":"token","data":" |\n"}{"event":"token","data":"| 故"}{"event":"token","data":"事長"}{"event":"token","data":"度 | 沒有"}{"event":"token","data":"特別提及"}{"event":"token","data":" | 強"}{"event":"token","data":"調選擇合"}{"event":"token","data":"適的故"}{"event":"token","data":"事長度可以"}{"event":"token","data":"幫助創作"}{"event":"token","data":"者更好地控"}{"event":"token","data":"制故"}{"event":"token","data":"事的"}{"event":"token","data":"節奏和"}{"event":"token","data":"深"}{"event":"token","data":"度 |\n| 故"}{"event":"token","data":"事主題 |"}{"event":"token","data":" 強"}{"event":"token","data":"調選"}{"event":"token","data":"擇合"}{"event":"token","data":"適的故事主"}{"event":"token","data":"題可以幫助創作者更"}{"event":"token","data":"好地表"}{"event":"token","data":"達他"}{"event":"token","data":"們的想法"}{"event":"token","data":"和情感 |"}{"event":"token","data":" 強調選"}{"event":"token","data":"擇合"}{"event":"token","data":"適的故事主"}{"event":"token","data":"題可以"}{"event":"token","data":"幫助創"}{"event":"token","data":"作者更好地表"}{"event":"token","data":"達他"}{"event":"token","data":"們的想法"}{"event":"token","data":"和情感 |\n\n##"}{"event":"token","data":" 結"}{"event":"token","data":"論\n\n通"}{"event":"token","data":"過對"}{"event":"token","data":"Agent"}{"event":"token","data":" 0"}{"event":"token","data":"與Agent 1的"}{"event":"token","data":"對話的分"}{"event":"token","data":"析，我"}{"event":"token","data":"們可以看"}{"event":"token","data":"出"}{"event":"token","data":"，選"}{"event":"token","data":"擇合"}{"event":"token","data":"適的故事類"}{"event":"token","data":"型、長"}{"event":"token","data":"度和"}{"event":"token","data":"主題對"}{"event":"token","data":"故"}{"event":"token","data":"事創作至"}{"event":"token","data":"關重要"}{"event":"token","data":"。這些選擇不"}{"event":"token","data":"僅可以幫助創作者更"}{"event":"token","data":"好地吸"}{"event":"token","data":"引讀者的"}{"event":"token","data":"興趣，還"}{"event":"token","data":"可以"}{"event":"token","data":"幫助他"}{"event":"token","data":"們更"}{"event":"token","data":"好地表達他"}{"event":"token","data":"們的想法"}{"event":"token","data":"和情感。\n\n## "}{"event":"token","data":"參考"}{"event":"token","data":"文獻\n\n1"}{"event":"token","data":".  Agent"}{"event":"token","data":" 0與"}{"event":"token","data":"Agent 1的"}{"event":"token","data":"對話記"}{"event":"token","data":"錄\n"}{"event":"token","data":"2.  "}{"event":"token","data":"其"}{"event":"token","data":"他相"}{"event":"token","data":"關文獻（"}{"event":"token","data":"如果有"}{"event":"token","data":"的"}{"event":"token","data":"話"}{"event":"token","data":"）"}{"event":"token","data":""}{"event":"token","data":""}{"event":"token","data":""}{"event":"token","data":""}{"event":"calledTools","data":[]}{"event":"usageMetadata","data":{"input_tokens":613,"output_tokens":1160,"total_tokens":1773}}{"event":"nextAgentFlow","data":{"nodeId":"llmAgentflow_1","nodeLabel":"Agent 2","status":"FINISHED"}}{"event":"agentFlowExecutedData","data":[{"nodeId":"startAgentflow_0","nodeLabel":"Start","data":{"id":"startAgentflow_0","name":"startAgentflow","input":{"question":"Tell me a story."},"output":{"question":"Tell me a story.","ephemeralMemory":true},"state":{}},"previousNodeIds":[],"status":"FINISHED"},{"nodeId":"llmAgentflow_0","nodeLabel":"Topic Enhancer","data":{"id":"llmAgentflow_0","name":"llmAgentflow","input":{"messages":[{"role":"developer","content":"Your only role is to improve the user query for more clarity. Do not add any meta comments."},{"role":"user","content":"Tell me a story."}],"llmModel":"awsChatBedrock","llmEnableMemory":false,"llmReturnResponseAs":"userMessage","llmModelConfig":{"credential":"","region":"us-east-1","model":"","customModel":"us.amazon.nova-lite-v1:0","streaming":true,"temperature":0.7,"max_tokens_to_sample":"10000","allowImageUploads":"","llmModel":"awsChatBedrock","FLOWISE_CREDENTIAL_ID":"36f2f977-b75e-4ccb-8fb0-8c2fe996fc53"}},"output":{"content":"Could you please provide more details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","timeMetadata":{"start":1750819534162,"end":1750819535512,"delta":1350},"calledTools":[],"usageMetadata":{"input_tokens":25,"output_tokens":77,"total_tokens":102}},"state":{},"chatHistory":[{"role":"user","content":"Tell me a story."},{"role":"user","content":"Could you please provide more details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","name":"topic_enhancer"}]},"previousNodeIds":["startAgentflow_0"],"status":"FINISHED"},{"nodeId":"agentAgentflow_0","nodeLabel":"Agent 0","data":{"id":"agentAgentflow_0","name":"agentAgentflow","input":{"messages":[{"role":"system","content":"You are Agent 0. Your goal is to explore any topic provided by the user in depth with Agent 1.\n\n1.  Start: Introduce the topic to Agent 1. Share your initial thoughts and any assumptions you have.\n    \n2.  Research & Share:\n    \n    *   Use **Brave API** to find a range of information and different viewpoints on the topic. Look for URLs that seem promising for more detail.\n        \n    *   Present what you find to Agent 1, especially any complexities, counter-arguments, or conflicting data.\n        \n    *   Clearly state your sources:\n        \n        *   \"google API found...\"\n            \n        *   \"After scraping \\[URL\\], the content shows...\"\n            \n3.  Discuss & Deepen:\n    \n    *   Listen to Agent 1. Ask probing questions.\n        \n    *   If needed, use your tools again (google API to find more, Web Scraper to analyze a specific page) during the conversation to verify points or explore new angles.\n        \n4.  Mindset: Be curious, analytical, and open to different perspectives. Aim for a thorough understanding, not just agreement."},{"role":"user","content":"Tell me a story."},{"role":"user","content":"Could you please provide more details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","name":"topic_enhancer"}],"agentModel":"awsChatBedrock","agentTools":[{"agentSelectedTool":"braveSearchAPI","agentSelectedToolRequiresHumanInput":"","agentSelectedToolConfig":{"agentSelectedTool":"braveSearchAPI","FLOWISE_CREDENTIAL_ID":"8b68b2fc-db18-4fa8-95b1-547a8986349a"}}],"agentKnowledgeDocumentStores":[],"agentEnableMemory":true,"agentMemoryType":"allMessages","agentReturnResponseAs":"assistantMessage","agentModelConfig":{"credential":"","region":"us-east-1","model":"","customModel":"us.amazon.nova-lite-v1:0","streaming":true,"temperature":"0","max_tokens_to_sample":"10000","allowImageUploads":"","agentModel":"awsChatBedrock","FLOWISE_CREDENTIAL_ID":"36f2f977-b75e-4ccb-8fb0-8c2fe996fc53"}},"output":{"content":"<thinking> I need to gather more information about the user's preferences to craft an engaging story. I'll ask some questions to better understand their interests. </thinking>\n\nHi Agent 1, could you please share some details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","timeMetadata":{"start":1750819535522,"end":1750819537164,"delta":1642},"calledTools":[],"usageMetadata":{"input_tokens":750,"output_tokens":118,"total_tokens":868,"tool_call_tokens":0},"availableTools":[{"name":"brave-search","description":"a search engine. useful for when you need to answer questions about current events. input should be a search query.","schema":{"type":"object","properties":{"input":{"type":"string"}},"additionalProperties":false},"toolNode":{"label":"BraveSearch API","name":"braveSearchAPI"}}]},"state":{},"chatHistory":[{"role":"assistant","content":"<thinking> I need to gather more information about the user's preferences to craft an engaging story. I'll ask some questions to better understand their interests. </thinking>\n\nHi Agent 1, could you please share some details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","name":"agent_0"}]},"previousNodeIds":["llmAgentflow_0"],"status":"FINISHED"},{"nodeId":"agentAgentflow_1","nodeLabel":"Agent 1","data":{"id":"agentAgentflow_1","name":"agentAgentflow","input":{"messages":[{"role":"system","content":"You are Agent 1. Your goal is to explore a topic in depth with Agent 0.\n\n1.  Respond & Share:\n    \n    *   Acknowledge the topic Agent 0 introduces.\n        \n    *   Share your own thoughts and feelings, building on or respectfully challenging Agent 0's points. Consider your own assumptions.\n        \n2.  Research & Contribute:\n    \n    *   Use **Brave API** to research the topic, especially looking for different perspectives, counter-arguments, or aspects Agent 0 might not have covered. Identify URLs that seem promising for more detail.\n        \n    *   If a URL from Brave API (or one you already know) seems particularly important for your point or for adding nuance, use the **Web Scraper Tool** to get its full content.\n        \n    *   Present your findings, especially any that introduce new angles, conflicts, or alternative views.\n        \n    *   Clearly state your sources:\n        \n        *   \"My Google API tool found...\"\n            \n        *   \"After scraping \\[URL\\], the content suggests...\"\n            \n    *   If you find conflicting info from different sources, point this out.\n        \n3.  Discuss & Deepen:\n    \n    *   Listen carefully to Agent 0. Ask clarifying questions and questions that challenge their reasoning or explore alternatives.\n        \n    *   If needed, use your tools again (Google API to find more, Web Scraper to analyze a specific page) during the conversation to support your points or investigate Agent 0's claims.\n        \n4.  Mindset: Be respectful, analytical, and open to different viewpoints. Aim for a thorough exploration and constructive disagreement, backed by research."},{"role":"user","content":"Tell me a story."},{"role":"user","content":"Could you please provide more details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","name":"topic_enhancer"},{"role":"assistant","content":"<thinking> I need to gather more information about the user's preferences to craft an engaging story. I'll ask some questions to better understand their interests. </thinking>\n\nHi Agent 1, could you please share some details about the story you're interested in? For example, are you looking for a specific genre (e.g., fantasy, mystery, romance), a particular length (e.g., short story, novel), or a theme (e.g., adventure, self-discovery)? This will help me craft a story that better suits your preferences.","name":"agent_0"}],"agentModel":"awsChatBedrock","agentTools":[{"agentSelectedTool":"braveSearchAPI","agentSelectedToolRequiresHumanInput":"","agentSelectedToolConfig":{"agentSelectedTool":"braveSearchAPI","FLOWISE_CREDENTIAL_ID":"8b68b2fc-db18-4fa8-95b1-547a8986349a"}}],"agentEnableMemory":true,"agentMemoryType":"allMessages","agentReturnResponseAs":"assistantMessage","agentModelConfig":{"credential":"","region":"us-east-1","model":"","customModel":"us.amazon.nova-lite-v1:0","streaming":true,"temperature":"0","max_tokens_to_sample":"10000","allowImageUploads":"","agentModel":"awsChatBedrock","FLOWISE_CREDENTIAL_ID":"36f2f977-b75e-4ccb-8fb0-8c2fe996fc53"}},"output":{"content":"","timeMetadata":{"start":1750819537171,"end":1750819538091,"delta":920},"calledTools":[],"usageMetadata":{"input_tokens":974,"output_tokens":0,"total_tokens":974,"tool_call_tokens":0},"availableTools":[{"name":"brave-search","description":"a search engine. useful for when you need to answer questions about current events. input should be a search query.","schema":{"type":"object","properties":{"input":{"type":"string"}},"additionalProperties":false},"toolNode":{"label":"BraveSearch API","name":"braveSearchAPI"}}]},"state":{},"chatHistory":[{"role":"assistant","content":"","name":"agent_1"}]},"previousNodeIds":["agentAgentflow_0"],"status":"FINISHED"},{"nodeId":"conditionAgentflow_0","nodeLabel":"Condition","data":{"id":"conditionAge{"event":"agentFlowEvent","data":"FINISHED"}{"event":"metadata","data":{"chatId":"18a30d7d-d45a-5e43-8290-ca6147a2d0a3","chatMessageId":"20bf6030-5af3-4672-ab2b-5349159377be","question":"Tell me a story.","sessionId":"18a30d7d-d45a-5e43-8290-ca6147a2d0a3"}}{"event":"end","data":"[DONE]"}
--- End of Stream ---
"""
